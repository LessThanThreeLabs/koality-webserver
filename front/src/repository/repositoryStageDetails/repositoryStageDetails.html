<div id="repositoryStageDetails" ng-controller="RepositoryStageDetails">
	<panel>
		<panel-header>
			<div class="left">
				<span ng-show="selectedChange.getInformation() != null && selectedStage.isSummary()">summary</span>
				<span ng-show="selectedStage.getInformation() != null">{{selectedStage.getInformation().name}}</span>
				<span ng-show="selectedStage.isSkipped()">skipped</span>
				<span ng-show="selectedStage.isMerge()">merge</span>
				<span ng-show="selectedStage.isDebug()">debug</span>
			</div>

			<div class="right" ng-show="selectedStage.getInformation() != null && output.type != null">
				<a ng-click="output.type = 'lines'" ng-show="output.type != 'lines'">Show Text</a>
				<a ng-click="output.type = 'xunit'" ng-show="output.type != 'xunit' && selectedStage.getInformation().hasXUnit">Show JUnit</a>
			</div>
		</panel-header>

		<panel-body>
			<spinner id="loadingSpinner" running="spinnerOn"></spinner>

			<div id="summary" ng-show="selectedStage.isSummary() && selectedChange.getInformation() != null">
				<table>
					<tr>
						<th>Name</th>
						<td>{{selectedChange.getInformation().user.name.first}} {{selectedChange.getInformation().user.name.last}}</td>
					</tr>
					<tr>
						<th>Email</th>
						<td><a ng-href="mailto:{{selectedChange.getInformation().user.email}}?subject=Koality%3A%20{{selectedRepository.getInformation().name}}%20-%20change%20%23{{selectedChange.getInformation().headCommit.sha | limitTo:4}}&body=Link%20to%20change%3A%20{{currentUrl}}" target="_blank">{{selectedChange.getInformation().user.email}}</a></td>
					</tr>
					<tr>
						<th>Submit Time</th>
						<td>{{selectedChange.getInformation().createTime | date:'EEEE, MM/dd hh:mm:ss a'}}</td>
					</tr>
					<tr>
						<th>Branch</th>
						<td>{{selectedChange.getInformation().target}}</td>
					</tr>
					<tr>
						<th>Head SHA</th>
						<td>{{selectedChange.getInformation().headCommit.sha}}</td>
					</tr>
					<tr>
						<th>Head Commit</th>
						<td ng-bind-html="selectedChange.getInformation().headCommit.message | ascii"></td>
					</tr>
					<tr ng-show="exportUris.length > 0">
						<th>Exported Files</th>
						<td>
							<div ng-repeat="uri in exportUris"><a ng-href="{{uri}}" target="_blank">{{uri}}</a></div>
						</td>
					</tr>
				</table>
			</div>

			<div id="lines" ng-show="output.type == 'lines'">
				<div auto-scroll-to-bottom="output.lines" auto-scroll-to-bottom-buffer="40" start-at-bottom fading-content>
					<console-text class="consoleText" lines="output.lines"></console-text>
				</div>
			</div>

			<div id="xunit" ng-show="output.type == 'xunit'">
				<div fading-content>
					<table class="delineated">
						<tr>
						<th class="nameColumn sortableColumn unselectable" ng-click="jUnitOrderByPredicate = 'name'; jUnitOrderByReverse = !jUnitOrderByReverse">
							<div class="triangle gray" ng-class="{right: jUnitOrderByPredicate != 'name', up: jUnitOrderByPredicate == 'name' && !jUnitOrderByReverse, down: jUnitOrderByPredicate == 'name' && jUnitOrderByReverse}"></div>
							Name
						</th>
						<th class="statusColumn sortableColumn unselectable" ng-click="jUnitOrderByPredicate = 'status'; jUnitOrderByReverse = !jUnitOrderByReverse">
							<div class="triangle gray" ng-class="{right: jUnitOrderByPredicate != 'status', up: jUnitOrderByPredicate == 'status' && !jUnitOrderByReverse, down: jUnitOrderByPredicate == 'status' && jUnitOrderByReverse}"></div>
							Status
						</th>
						<th class="timeColumn sortableColumn unselectable" ng-click="jUnitOrderByPredicate = 'time'; jUnitOrderByReverse = !jUnitOrderByReverse">
							<div class="triangle gray" ng-class="{right: jUnitOrderByPredicate != 'time', up: jUnitOrderByPredicate == 'time' && !jUnitOrderByReverse, down: jUnitOrderByPredicate == 'time' && jUnitOrderByReverse}"></div>
							Duration
						</th>
					</tr>
						<tr ng-repeat="testCase in output.xunit.testCases | orderBy:output.xunit.orderByPredicate:output.xunit.orderByReverse" ng-class="{red: testCase.status == 'failed'}" ng-click="testCase.showMore = !testCase.showMore">
							<td class="nameColumn" ng-class="{selectable: testCase.failure != null || testCase.error != null}">
								{{testCase.name}}
								<div class="failureText" ng-show="testCase.showMore && testCase.failure != null">
									{{testCase.failure}}
								</div>
								<div class="errorText" ng-show="testCase.showMore && testCase.error != null">
									{{testCase.error}}
								</div>
							</td>
							<td class="statusColumn">{{testCase.status}}</td>
							<td class="timeColumn">{{testCase.time | number: 6}}</td>
						</tr>
					</table>
				</div>
			</div>

			<div id="skipped" ng-show="selectedStage.isSkipped()">
				<div id="skippedMessage">
					This change was not verified because Koality is deactivated.
				</div>
				<div id="skippedInstructions">
					Contact your administrator to fix your license.
				</div>
			</div>

			<div id="merge" ng-show="selectedStage.isMerge()">
				<div ng-show="selectedChange.getInformation().mergeStatus == 'passed'">
					Change merged successfully.
				</div>
				<div ng-show="selectedChange.getInformation().mergeStatus == 'failed'">
					Failed to merge. Try pulling before pushing again.
				</div>
			</div>

			<div id="debug" ng-show="selectedStage.isDebug()">
				<div id="debugMessage">
					This change failed to create any output. This could be caused by invalid AWS credentials.
				</div>
				<div id="debugInstructions">
					Contact your administrator to correct the issue.
				</div>
			</div>
		</panel-body>
	</panel>
</div>